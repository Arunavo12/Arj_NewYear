<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Happy New Year âœ¨</title>

<style>
:root{
  --bg:#070711;
  --text:#f3f4ff;
  --muted:#b9b9d6;
  --accent:#ff8fc8;
  --good:#41f5c0;
  --bad:#ff4d6d;
  --border: rgba(255,255,255,.14);
  --shadow:0 22px 90px rgba(0,0,0,.65);
}

*{box-sizing:border-box;}
html,body{height:100%;}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(1200px 600px at 20% 0%, rgba(124,92,255,.25), transparent 60%),
    radial-gradient(1000px 500px at 90% 20%, rgba(0,255,198,.12), transparent 60%),
    radial-gradient(900px 600px at 40% 120%, rgba(255,143,200,.18), transparent 55%),
    var(--bg);
  color:var(--text);
  min-height:100vh;
}

/* ===== FULLSCREEN OVERLAY ===== */
.overlay{
  position:fixed;
  inset:0;
  z-index:9999;
  display:grid;
  place-items:center;
  padding:
    calc(20px + env(safe-area-inset-top))
    calc(20px + env(safe-area-inset-right))
    calc(20px + env(safe-area-inset-bottom))
    calc(20px + env(safe-area-inset-left));
  background:
    radial-gradient(1200px 600px at 20% 0%, rgba(124,92,255,.35), transparent 60%),
    radial-gradient(1000px 500px at 90% 20%, rgba(0,255,198,.18), transparent 60%),
    radial-gradient(900px 600px at 40% 120%, rgba(255,143,200,.25), transparent 55%),
    rgba(7,7,17,.88);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: opacity .35s ease;
}
.overlay.hidden{ opacity:0; pointer-events:none; }

.panel{
  width:min(560px,95vw);
  text-align:center;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  border:1px solid var(--border);
  border-radius:28px;
  padding:22px 18px 18px;
  box-shadow:var(--shadow);
  position:relative;
  overflow:hidden;
}
.panel::before{
  content:"";
  position:absolute;
  inset:-2px;
  background:
    radial-gradient(500px 220px at 20% 0%, rgba(255,143,200,.18), transparent 55%),
    radial-gradient(500px 220px at 80% 20%, rgba(124,92,255,.18), transparent 55%);
  pointer-events:none;
}
.panel > *{ position:relative; z-index:1; }

.kicker{
  font-size:12.5px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:rgba(255,255,255,.78);
  margin-bottom:10px;
}

.countdownBig{
  font-size:clamp(38px,10vw,58px);
  font-weight:850;
  letter-spacing:-.02em;
  text-shadow: 0 18px 40px rgba(0,0,0,.45);
  user-select:none;
}

.countdownSmall{
  font-size:13px;
  color:var(--muted);
  margin: 4px 0 16px;
}

.pinRow{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:14px;
}
.pinBox{
  width:44px;
  height:52px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.18);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
}
.pinBox.filled::after{
  content:"â€¢";
  display:grid;
  place-items:center;
  font-size:28px;
  height:100%;
  color: rgba(255,255,255,.92);
}

.keypad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.key{
  height:54px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  color:white;
  font-size:18px;
  font-weight:800;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action: manipulation;
  transition: transform .08s ease, filter .12s ease, border-color .12s ease;
}
.key:active{
  transform: scale(.99);
  filter: brightness(1.06);
  border-color: rgba(255,255,255,.18);
}
.key.alt{
  font-size:13px;
  font-weight:800;
  color:rgba(255,255,255,.78);
}

.msg{
  margin-top:12px;
  min-height:18px;
  font-size:13px;
  line-height:1.35;
}
.msg.bad{color:var(--bad);}
.msg.good{color:var(--good);}

.previewHint{
  margin-top:10px;
  font-size:12px;
  color: rgba(255,255,255,.70);
  display:none;
}

.shake{animation:shake .35s;}
@keyframes shake{
  0%,100%{transform:translateX(0)}
  25%{transform:translateX(-8px)}
  50%{transform:translateX(8px)}
  75%{transform:translateX(-6px)}
}

/* ===== MAIN CONTENT ===== */
.frame{
  max-width:980px;
  margin:0 auto;
  padding:
    calc(28px + env(safe-area-inset-top))
    calc(18px + env(safe-area-inset-right))
    calc(44px + env(safe-area-inset-bottom))
    calc(18px + env(safe-area-inset-left));
  transition: filter .35s ease, opacity .35s ease, transform .35s ease;
}

.locked .frame{
  filter: blur(12px) saturate(1.05);
  opacity:.55;
  pointer-events:none;
  transform: scale(1.01);
}

h1{
  font-size:clamp(34px,6vw,58px);
  margin: 6px 0 10px;
  letter-spacing:-.02em;
  line-height:1.05;
}
.sub{
  color:var(--muted);
  max-width:70ch;
  line-height:1.6;
}

.grid{
  display:grid;
  grid-template-columns:1.1fr .9fr;
  gap:18px;
  margin-top:18px;
}
@media(max-width:850px){
  .grid{grid-template-columns:1fr}
}

.card{
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
  border: 1px solid rgba(255,255,255,.10);
  border-radius:20px;
  padding:16px;
  box-shadow: 0 14px 40px rgba(0,0,0,.35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

video{
  width:100%;
  border-radius:14px;
  background:black;
  display:block;
  border: 1px solid rgba(255,255,255,.08);
}

.footer{
  margin-top:18px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}

/* link button to letter page */
.readMore{
  display:inline-block;
  margin-top:10px;
  padding:10px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,143,200,.22), rgba(255,255,255,.08));
  color:#fff;
  text-decoration:none;
  font-weight:800;
}
.readMore:active{ transform: scale(.99); }

/* ===== QUIZ ===== */
.sectionTitle{
  margin: 28px 0 10px;
  font-size: 22px;
  letter-spacing: -.01em;
}
.sectionSub{
  margin: 0 0 14px;
  color: var(--muted);
  line-height: 1.6;
}

.quizWrap{ margin-top: 10px; display:grid; gap:14px; }

.quizBanner{
  padding: 14px;
  overflow:hidden;
}
.bannerImg{
  width:100%;
  height: 170px;
  object-fit: cover;
  border-radius: 16px;
  display:block;
  border:1px solid rgba(255,255,255,.08);
}
.bannerFallback{
  margin-top:10px;
  padding: 12px;
  border-radius: 16px;
  background: rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
}
.bannerTitle{
  font-weight: 900;
  letter-spacing: -.01em;
  font-size: 16px;
}
.bannerSub{
  margin-top: 4px;
  color: var(--muted);
  font-size: 13px;
}

.startCard{
  padding: 18px;
  text-align:center;
}
.startTitle{
  font-size: 20px;
  font-weight: 900;
  letter-spacing: -.01em;
}
.startText{
  margin: 8px auto 14px;
  color: var(--muted);
  max-width: 60ch;
  line-height:1.6;
}
.primaryBtn{
  width: min(280px, 100%);
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,143,200,.22), rgba(255,255,255,.08));
  color: rgba(255,255,255,.95);
  padding: 12px 14px;
  font-weight: 900;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.primaryBtn:active{ transform: scale(.99); }
.startNote{
  margin-top: 10px;
  color: rgba(255,255,255,.65);
  font-size: 12px;
}

.quizHeader{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom: 2px;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:999px;
  background: rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
  color: rgba(255,255,255,.78);
  font-size:12px;
}
.pill strong{ color: rgba(255,255,255,.92); font-weight:900; }

.qCard{ padding: 16px; }
.qTitle{
  font-size: 16px;
  font-weight: 900;
  letter-spacing: -.01em;
  margin: 0 0 10px;
}
.answers{ display:grid; gap:10px; }
.ansBtn{
  width:100%;
  text-align:left;
  border-radius:16px;
  border: 1px solid rgba(255,255,255,.12);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  color: rgba(255,255,255,.92);
  padding: 12px 12px;
  cursor:pointer;
  font-weight: 800;
  transition: transform .08s ease, filter .12s ease, border-color .12s ease;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.ansBtn:active{
  transform: scale(.99);
  filter: brightness(1.06);
  border-color: rgba(255,255,255,.18);
}
.ansBtn small{
  display:block;
  margin-top: 4px;
  font-weight: 650;
  color: rgba(255,255,255,.68);
}

.quizNav{
  display:flex;
  justify-content:space-between;
  gap:10px;
  margin-top: 10px;
}
.secondaryBtn{
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
  color: rgba(255,255,255,.85);
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
}
.secondaryBtn:active{ transform: scale(.99); }

.resultCard{ padding: 18px; display:none; }
.resultCard.show{ display:block; }

.resultImageWrap{
  width:100%;
  aspect-ratio: 16 / 9;
  height: auto;
  border-radius: 18px;
  background: rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
  overflow:hidden;
  margin-bottom: 12px;
}
.resultImage{
  width:100%;
  height:100%;
  object-fit: contain;
  background: rgba(0,0,0,.35);
  display:block;
}

.resultBadge{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
  margin-bottom: 12px;
}
.resultLogo{
  width: 26px;
  height: 26px;
  object-fit: contain;
  display:none;
}
.resultEmoji{ font-size: 18px; }
.resultName{ font-weight: 950; letter-spacing: -.01em; }

.resultText{
  color: rgba(255,255,255,.90);
  line-height: 1.75;
}
.resultHint{
  margin-top: 10px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.6;
}

.hidden{ display:none !important; }
</style>
</head>

<body class="locked">

<!-- FULLSCREEN LOCK -->
<section class="overlay" id="overlay">
  <div class="panel" id="panel">
    <div class="kicker">Countdown to New Year (Arj)</div>
    <div class="countdownBig" id="countdown" title="(secret) press and hold to preview">00:00:00</div>
    <div class="countdownSmall" id="countdownText">Unlocks at midnight on New Years</div>

    <div class="pinRow">
      <div class="pinBox" id="b1"></div>
      <div class="pinBox" id="b2"></div>
      <div class="pinBox" id="b3"></div>
      <div class="pinBox" id="b4"></div>
      <div class="pinBox" id="b5"></div>
      <div class="pinBox" id="b6"></div>
    </div>

    <div class="keypad">
      <button class="key" data-n="1" type="button">1</button>
      <button class="key" data-n="2" type="button">2</button>
      <button class="key" data-n="3" type="button">3</button>
      <button class="key" data-n="4" type="button">4</button>
      <button class="key" data-n="5" type="button">5</button>
      <button class="key" data-n="6" type="button">6</button>
      <button class="key" data-n="7" type="button">7</button>
      <button class="key" data-n="8" type="button">8</button>
      <button class="key" data-n="9" type="button">9</button>
      <button class="key alt" id="clear" type="button">Clear</button>
      <button class="key" data-n="0" type="button">0</button>
      <button class="key alt" id="del" type="button">Delete</button>
    </div>

    <div class="msg" id="msg"></div>
    <div class="previewHint" id="previewHint">Preview mode is ON â€” lock bypassed.</div>
  </div>
</section>

<!-- CONTENT -->
<main class="frame">
  <h1>Happy New Year ðŸŽ†</h1>
  <p class="sub">Replace this with your message.</p>

  <div class="grid">
    <div class="card">
      <video controls playsinline preload="metadata">
        <source src="ARJ.mp4" type="video/mp4">
      </video>
      <p class="sub" style="margin:10px 0 0; font-size:12px;">
      </p>
    </div>

    <!-- OPTION 1: link to separate letter page -->
    <div class="card">
      <p class="sub" style="color:rgba(255,255,255,.92); margin:0;">
        I wrote you something longer, but it didnâ€™t fit nicely on this page.
      </p>
      <a class="readMore" href="letter.html">Click here to read it ðŸ’Œ</a>
    </div>
  </div>

  <!-- QUIZ SECTION -->
  <h2 class="sectionTitle">ATLA Quiz: Which Nation are you most like?</h2>
  <p class="sectionSub">
    You watched this because itâ€™s my favourite show ðŸ˜Œ Now answer honestly and letâ€™s see where you belong.
  </p>

  <div class="quizWrap">
    <div class="card quizBanner">
      <img class="bannerImg" src="quiz_banner.png" alt="ATLA Quiz Banner" onerror="this.style.display='none'">
      <div class="bannerFallback">
        <div class="bannerTitle">The Bending Nation Test</div>
        <div class="bannerSub">15 questions â€¢ One result â€¢ No cheating ðŸ˜Œ</div>
      </div>
    </div>

    <div class="card startCard" id="startCard">
      <div class="startTitle">Ready?</div>
      <div class="startText">
        Pick the answer that feels most like you. Donâ€™t overthink it â€” first instinct wins.
      </div>
      <button class="primaryBtn" id="startBtn" type="button">Start Quiz</button>
      <div class="startNote">Tip: You can go back if you change your mind.</div>
    </div>

    <div class="quizHeader hidden" id="quizHeader">
      <div class="pill">Question <strong id="qIndex">1</strong> / <strong id="qTotal">15</strong></div>
      <div class="pill">Your vibe: <strong id="liveVibe">â€”</strong></div>
    </div>

    <div class="card qCard hidden" id="questionCard">
      <div class="qTitle" id="qText">Loadingâ€¦</div>
      <div class="answers" id="answers"></div>

      <div class="quizNav">
        <button class="secondaryBtn" id="backBtn" type="button">Back</button>
        <button class="secondaryBtn" id="resetBtn" type="button">Restart</button>
      </div>
    </div>

    <div class="card resultCard" id="resultCard">
      <div class="resultImageWrap">
        <img id="resultImage" class="resultImage" alt="Nation image">
      </div>

      <div class="resultBadge">
        <img id="resultLogo" class="resultLogo" alt="Nation logo">
        <span class="resultEmoji" id="resEmoji">âœ¨</span>
        <span class="resultName" id="resName">Result</span>
      </div>

      <div class="resultText" id="resText"></div>
      <div class="resultHint" id="resHint"></div>

      <div class="quizNav" style="margin-top:14px;">
        <button class="secondaryBtn" id="retakeBtn" type="button">Retake quiz</button>
      </div>
    </div>
  </div>

  <div class="footer">Made with love âœ¨</div>
</main>

<script>
/************* YOUR CONFIG *************/
const CORRECT_PIN = "151021";
const UNLOCK_YEAR = 2026;
const UNLOCK_AT = new Date(UNLOCK_YEAR, 0, 1, 0, 0, 0, 0);

/************* OPTIONAL URL PREVIEW MODE *************/
const URL_PREVIEW_MODE = location.hash.toLowerCase() === "#preview";

/************* STATE *************/
let pin = "";
let correct = false;

const overlay = document.getElementById("overlay");
const panel  = document.getElementById("panel");
const msgEl  = document.getElementById("msg");

const delBtn   = document.getElementById("del");
const clearBtn = document.getElementById("clear");

const countdownEl = document.getElementById("countdown");
const countdownTextEl = document.getElementById("countdownText");

const boxes = [...Array(6)].map((_, i) => document.getElementById("b" + (i + 1)));

function updateDots(){
  boxes.forEach((b, i) => b.classList.toggle("filled", i < pin.length));
}

function resetPin(withShake){
  pin = "";
  updateDots();
  if(withShake){
    panel.classList.remove("shake");
    void panel.offsetWidth;
    panel.classList.add("shake");
  }
}

function showMessage(text, kind){
  msgEl.textContent = text;
  msgEl.className = "msg" + (kind ? " " + kind : "");
}

function unlock(){
  document.body.classList.remove("locked");
  overlay.classList.add("hidden");
  setTimeout(() => { overlay.style.display = "none"; }, 360);
}

function checkPin(){
  if(pin !== CORRECT_PIN){
    showMessage("Wrong code- Hint: you can find it on Snapchat", "bad");
    correct = false;
    resetPin(true);
    return;
  }

  correct = true;

  if(Date.now() < UNLOCK_AT.getTime()){
    showMessage("Correct code â€” will open after midnight on New Years", "good");
    resetPin(false);
    return;
  }

  unlock();
}

/************* INPUT *************/
document.querySelectorAll(".key[data-n]").forEach(btn => {
  btn.addEventListener("click", () => {
    if(pin.length >= 6) return;
    pin += btn.dataset.n;
    updateDots();
    if(pin.length === 6) setTimeout(checkPin, 120);
  });
});

delBtn.addEventListener("click", () => {
  pin = pin.slice(0, -1);
  updateDots();
});

clearBtn.addEventListener("click", () => {
  resetPin(false);
  showMessage("", "");
});

// Desktop keyboard support
window.addEventListener("keydown", (e) => {
  if(overlay.style.display === "none") return;

  if(/^\d$/.test(e.key)){
    if(pin.length < 6){
      pin += e.key;
      updateDots();
      if(pin.length === 6) setTimeout(checkPin, 120);
    }
  } else if(e.key === "Backspace"){
    pin = pin.slice(0, -1);
    updateDots();
  } else if(e.key === "Escape"){
    resetPin(false);
    showMessage("", "");
  }
});

/************* COUNTDOWN *************/
const pad2 = (n) => String(n).padStart(2, "0");

function tick(){
  const diffMs = UNLOCK_AT.getTime() - Date.now();

  if(diffMs <= 0){
    countdownEl.textContent = "00:00:00";
    countdownTextEl.textContent = "Itâ€™s midnight ðŸŽ‰";
    if(correct) unlock();
    return;
  }

  const total = Math.ceil(diffMs / 1000);
  const h = Math.floor(total / 3600);
  const m = Math.floor((total % 3600) / 60);
  const s = total % 60;

  countdownEl.textContent = `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
}

tick();
setInterval(tick, 250);

/************* SECRET BYPASS: PRESS & HOLD COUNTDOWN (3s) *************/
let holdTimer = null;
let holding = false;

function startHold(){
  if(overlay.style.display === "none") return;
  holding = true;
  if(pin.length === 0) showMessage("Holdâ€¦ (secret preview)", "");
  holdTimer = setTimeout(() => {
    if(!holding) return;
    document.getElementById("previewHint").style.display = "block";
    showMessage("Preview unlocked âœ…", "good");
    unlock();
  }, 3000);
}
function endHold(){
  holding = false;
  if(holdTimer){
    clearTimeout(holdTimer);
    holdTimer = null;
  }
}
countdownEl.addEventListener("pointerdown", (e) => { e.preventDefault(); startHold(); });
countdownEl.addEventListener("pointerup", endHold);
countdownEl.addEventListener("pointercancel", endHold);
countdownEl.addEventListener("pointerleave", endHold);

// Fallback
countdownEl.addEventListener("touchstart", (e)=>{ e.preventDefault(); startHold(); }, {passive:false});
countdownEl.addEventListener("touchend", endHold);
countdownEl.addEventListener("touchcancel", endHold);

/************* OPTIONAL URL PREVIEW *************/
if(URL_PREVIEW_MODE){
  document.getElementById("previewHint").style.display = "block";
  unlock();
}

/* =========================================================
   =====================  ATLA QUIZ  =========================
   ========================================================= */

const quiz = {
  questions: [
    { q:"When something goes wrong, your first instinct is toâ€¦", a:[
      { t:"Talk it out and understand everyoneâ€™s feelings", s:{water:2} },
      { t:"Go straight into fix mode and push through", s:{fire:2} },
      { t:"Stay calm and deal with it step by step", s:{earth:2} },
      { t:"Laugh it off and move on", s:{air:2} },
    ]},
    { q:"What do people usually rely on you for?", a:[
      { t:"Emotional support and being there", s:{water:2} },
      { t:"Motivation / leadership energy", s:{fire:2} },
      { t:"Stability and reliability", s:{earth:2} },
      { t:"Good vibes and perspective", s:{air:2} },
    ]},
    { q:"You get one free day. You chooseâ€¦", a:[
      { t:"Chilling with someone you care about", s:{water:2} },
      { t:"Doing something productive / ambitious", s:{fire:2} },
      { t:"A comfy routine day (food + peace)", s:{earth:2} },
      { t:"Random adventure / something new", s:{air:2} },
    ]},
    { q:"How do you handle pressure?", a:[
      { t:"I feel it deeply, but I keep going", s:{water:2} },
      { t:"It fuels me â€” I lock in", s:{fire:2} },
      { t:"I stay steady and push through", s:{earth:2} },
      { t:"I try not to let it stick to me", s:{air:2} },
    ]},
    { q:"Your ideal environment isâ€¦", a:[
      { t:"Calm, reflective, near water", s:{water:2} },
      { t:"Energetic, intense, always moving", s:{fire:2} },
      { t:"Familiar, solid, comfortable", s:{earth:2} },
      { t:"Open, free, changing, adventurous", s:{air:2} },
    ]},
    { q:"How do you deal with conflict?", a:[
      { t:"Try to understand everyoneâ€™s side", s:{water:2} },
      { t:"Face it head-on", s:{fire:2} },
      { t:"Avoid drama; handle it quietly", s:{earth:2} },
      { t:"Detach and let it pass", s:{air:2} },
    ]},
    { q:"What drives you most?", a:[
      { t:"Connection", s:{water:2} },
      { t:"Purpose and ambition", s:{fire:2} },
      { t:"Security and loyalty", s:{earth:2} },
      { t:"Freedom", s:{air:2} },
    ]},
    { q:"Pick a weakness you relate to most:", a:[
      { t:"Feeling things too deeply", s:{water:2, air:1} },
      { t:"Acting before thinking", s:{fire:2} },
      { t:"Being stubborn", s:{earth:2} },
      { t:"Avoiding responsibility sometimes", s:{air:2} },
    ]},
    { q:"People would describe you asâ€¦", a:[
      { t:"Caring and intuitive", s:{water:2} },
      { t:"Bold and passionate", s:{fire:2} },
      { t:"Reliable and grounded", s:{earth:2} },
      { t:"Funny and lighthearted", s:{air:2} },
    ]},
    { q:"If you had bending, youâ€™d use it toâ€¦", a:[
      { t:"Heal or protect people", s:{water:2, earth:1} },
      { t:"Get stronger and prove yourself", s:{fire:2} },
      { t:"Defend what matters most", s:{earth:2} },
      { t:"Travel and explore freely", s:{air:2} },
    ]},
    { q:"Which philosophy feels most like you?", a:[
      { t:"Flow with life â€” adapt, donâ€™t force", s:{water:2} },
      { t:"If I want it, I earn it", s:{fire:2} },
      { t:"Stand your ground â€” consistency wins", s:{earth:2} },
      { t:"Let go â€” donâ€™t carry what you donâ€™t need", s:{air:2} },
    ]},
    { q:"In a group project, you naturally become theâ€¦", a:[
      { t:"Peacemaker â€” keeping everyone aligned", s:{water:2} },
      { t:"Driver â€” pushing the team to finish strong", s:{fire:2} },
      { t:"Planner â€” making it structured and realistic", s:{earth:2} },
      { t:"Ideas person â€” big picture + creativity", s:{air:2} },
    ]},
    { q:"What annoys you the most?", a:[
      { t:"Coldness / lack of empathy", s:{water:2} },
      { t:"Laziness / no ambition", s:{fire:2} },
      { t:"Unreliability / inconsistency", s:{earth:2} },
      { t:"Being controlled / told what to do", s:{air:2} },
    ]},
    { q:"If you could master ONE bending skill instantly, youâ€™d pickâ€¦", a:[
      { t:"Healing (helping someone recover)", s:{water:2} },
      { t:"Lightning (precision + power)", s:{fire:2} },
      { t:"Metalbending (control + strength)", s:{earth:2} },
      { t:"Flight / extreme agility (pure freedom)", s:{air:2} },
    ]},
    { q:"Which characterâ€™s personality is most like you?", a:[
      { t:"Sokka", s:{air:1, earth:2} },
      { t:"Iroh", s:{water:2, fire:1} },
      { t:"Azula", s:{fire:2, earth:1} },
      { t:"Appa", s:{earth:2, water:1} },
    ]},
  ],
  results: {
    water: { emoji:"ðŸŒŠ", name:"Water Tribe", img:"nation_water.png", logo:"nation_water.png",
      text:"Youâ€™re adaptable, emotionally intelligent, and you care deeply. People feel safe around you â€” even if you donâ€™t always realise it. You handle situations with empathy and you bounce back by flowing around problems instead of forcing them.",
      hint:"Water isnâ€™t weak â€” itâ€™s resilient. It survives, it heals, and it always finds a way."
    },
    fire: { emoji:"ðŸ”¥", name:"Fire Nation", img:"nation_fire.png", logo:"nation_fire.png",
      text:"Youâ€™re driven, passionate, and intense in a good way. When you want something, you go for it. Your energy can light up a whole room â€” and like the best firebenders, your real strength is learning control and growth.",
      hint:"Fire is power + purpose. When itâ€™s balanced, it becomes unstoppable."
    },
    earth:{ emoji:"ðŸŒ¿", name:"Earth Kingdom", img:"nation_earth.png", logo:"nation_earth.png",
      text:"Youâ€™re grounded, loyal, and solid. You show up. You donâ€™t fold easily under pressure, and you protect the people you care about. Youâ€™re the person others trust when things get serious.",
      hint:"Earth stands its ground. Stable, reliable, and quietly strong."
    },
    air:  { emoji:"ðŸ’¨", name:"Air Nomads", img:"nation_air.png", logo:"nation_air.png",
      text:"You value freedom, humour, and perspective. You bring lightness to heavy moments and you donâ€™t let stress trap you for long. Youâ€™re creative, open-minded, and youâ€™d rather move forward than stay stuck.",
      hint:"Air teaches you to let go. Not careless â€” just free."
    }
  }
};

const startCard = document.getElementById("startCard");
const startBtn = document.getElementById("startBtn");
const quizHeader = document.getElementById("quizHeader");

const qIndexEl = document.getElementById("qIndex");
const qTotalEl = document.getElementById("qTotal");
const liveVibeEl = document.getElementById("liveVibe");

const qCard = document.getElementById("questionCard");
const qTextEl = document.getElementById("qText");
const answersEl = document.getElementById("answers");

const backBtn = document.getElementById("backBtn");
const resetBtn = document.getElementById("resetBtn");

const resultCard = document.getElementById("resultCard");
const resEmojiEl = document.getElementById("resEmoji");
const resNameEl = document.getElementById("resName");
const resTextEl = document.getElementById("resText");
const resHintEl = document.getElementById("resHint");
const retakeBtn = document.getElementById("retakeBtn");

const resultImage = document.getElementById("resultImage");
const resultLogo = document.getElementById("resultLogo");

qTotalEl.textContent = String(quiz.questions.length);

let step = 0;
let scores = { water:0, fire:0, earth:0, air:0 };
let history = [];

function vibeFromScores(){
  const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top = entries[0];
  if(!top || top[1]===0) return "â€”";
  const map = { water:"Water", fire:"Fire", earth:"Earth", air:"Air" };
  return map[top[0]] ?? "â€”";
}
function applyScore(delta){
  for(const [k,v] of Object.entries(delta)){
    if(scores[k]==null) scores[k]=0;
    scores[k]+=v;
  }
}

function showStart(){
  startCard.classList.remove("hidden");
  quizHeader.classList.add("hidden");
  qCard.classList.add("hidden");
  resultCard.classList.remove("show");
  liveVibeEl.textContent = "â€”";
}

function startQuiz(){
  startCard.classList.add("hidden");
  quizHeader.classList.remove("hidden");
  qCard.classList.remove("hidden");
  renderQuestion();
}

function renderQuestion(){
  resultCard.classList.remove("show");
  qIndexEl.textContent = String(step+1);
  liveVibeEl.textContent = vibeFromScores();

  const item = quiz.questions[step];
  qTextEl.textContent = item.q;

  answersEl.innerHTML = "";
  item.a.forEach((ans, idx) => {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "ansBtn";
    btn.innerHTML = `${ans.t}<small>Tap to choose</small>`;
    btn.addEventListener("click", () => chooseAnswer(idx));
    answersEl.appendChild(btn);
  });

  backBtn.disabled = (step===0);
  backBtn.style.opacity = (step===0) ? ".5" : "1";
}

function chooseAnswer(idx){
  const item = quiz.questions[step];

  if(history[step]!=null){
    const old = item.a[history[step]];
    const neg = {};
    for(const [k,v] of Object.entries(old.s)) neg[k] = -v;
    applyScore(neg);
  }

  history[step] = idx;
  applyScore(item.a[idx].s);

  if(step < quiz.questions.length - 1){
    step += 1;
    renderQuestion();
  } else {
    showResult();
  }
}

function showResult(){
  const order = ["water","fire","earth","air"];
  let best = "water";
  for(const k of order){
    if(scores[k] > scores[best]) best = k;
  }
  const r = quiz.results[best];

  resEmojiEl.textContent = r.emoji;
  resNameEl.textContent = r.name;
  resTextEl.textContent = r.text;
  resHintEl.textContent = r.hint;

  resultImage.src = r.img;
  resultImage.onerror = () => resultImage.removeAttribute("src");

  resultLogo.src = r.logo;
  resultLogo.style.display = "inline-block";
  resultLogo.onerror = () => { resultLogo.style.display="none"; resultLogo.removeAttribute("src"); };

  qCard.classList.add("hidden");
  resultCard.classList.add("show");
  quizHeader.classList.remove("hidden");
  liveVibeEl.textContent = r.name;

  resultCard.scrollIntoView({ behavior:"smooth", block:"start" });
}

function restartQuiz(){
  step = 0;
  scores = { water:0, fire:0, earth:0, air:0 };
  history = [];
  showStart();
  startCard.scrollIntoView({ behavior:"smooth", block:"start" });
}

backBtn.addEventListener("click", () => {
  if(step===0) return;

  const current = quiz.questions[step];
  if(history[step]!=null){
    const chosen = current.a[history[step]];
    const neg = {};
    for(const [k,v] of Object.entries(chosen.s)) neg[k] = -v;
    applyScore(neg);
    history[step] = null;
  }

  step -= 1;
  renderQuestion();
});

resetBtn.addEventListener("click", restartQuiz);
retakeBtn.addEventListener("click", restartQuiz);
startBtn.addEventListener("click", startQuiz);

// init
showStart();
</script>

</body>
</html>
